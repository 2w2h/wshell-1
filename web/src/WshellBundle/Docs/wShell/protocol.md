### WAMP сообщение

Вычислительный кластер, выполняющий юниты, получает задания в виде WAMP сообщений.
Каждое сообщение является обычным массивом json объектов, каждый из которых содержит
код самого юнита и дополнительную информацию о том, как этот код выполнять и что делать с полученными
после выполнения данными.

WAMP сообщения генерятся автоматически из CDL выражений.

Пример:

    {[
    	{
    		'index':1,
        'order':1,
    		'require':['php', 'php-wshell'],
    		'source': 'код юнита',
    		'args': {'url':'http://acomics.ru/comics', 'selector':'div.title a[href]'}
    	},
    	{
    		'index':2,
        'order':2,
    		'require':['php'],
    		'source': 'код юнита',
        'chainArgs': ['urls':{'index':1, 'selector':'200'}]
    	}
    ]}

Обязательные поля:

* index - уникальный номер юнита в цепочке.
* order - Порядок выполнения. Несколько юнитов с одинаковым номером означают, что их можно выполнить
параллельно.
* require - список требований к выполнению. Здесь, как минимум, указывается язык программирования,
на котором написан юнит. Используется для выбора исполнителя (см.дальше)
* source - исходный код

Дополнительные поля:

* mode - режим юнита, если он имеет несколько режимов (только для юнитов с требованиями вида __*-wshell__ )
* args - аргументы, передаваемые в юнит
* chainArgs - аргументы, зависимые от выходных данных других юнитов. Каждый представлен объектом,
содержащим 2 поля - index(номер юнита) и selector (для выбора данных из вывода юнита). Если selector
не указан, весь вывод юнита идёт в этот аргумент.

### Выбор исполнителя

Так как сеть [одноранговая](https://ru.wikipedia.org/wiki/%D0%9E%D0%B4%D0%BD%D0%BE%D1%80%D0%B0%D0%BD%D0%B3%D0%BE%D0%B2%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C) (все клиенты одинаковые с точки зрения роутера и могут нести свою логику),
нужен свой механизм разграничения обязанностей. Для этого клиенты с помощью протокола наделяются
ролями: Sender и/или Executor, причём Executor может быть Master или Slave.  
Процесс выбора исполнителя следующий:

* Sender отправляет сообщение на ближайший Master (в топик wshell.system.executor)
* Master создает топик вида wshell.execute.ID и пересылает всем известным ему Slaves
* Клиенты, способные выполнить хотябы один юнит, подписываются на топик и отправляют в него массив
из order юнитов, которые смогут выполнить + инфу о себе (местоположение, свободные ресурсы)
* Master на основании этих данных выбирает исполнителей и отказывает остальным.
* Те, кто получил подтверждение, выполняют юнит и возвращают результат в специальном формате.
Те, кто получил отказ, просто удаляют сообщение.
* Master возвращает в Sender результат вычислений.
